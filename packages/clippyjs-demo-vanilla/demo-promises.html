<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Clippy.js - Promise-based API Demo</title>
        <link rel="stylesheet" href="../dist/clippy.css" />
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background: linear-gradient(
                    to bottom,
                    #f0f9ff 0%,
                    #e0f2fe 100%
                );
                min-height: 100vh;
            }

            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: white;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            h1 {
                color: #333;
            }

            .controls {
                margin: 20px 0;
            }

            button {
                padding: 8px 15px;
                margin: 5px;
                border: none;
                border-radius: 4px;
                background: #007bff;
                color: white;
                cursor: pointer;
                transition: background 0.2s;
            }

            button:hover {
                background: #0056b3;
            }

            button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            select,
            input {
                padding: 8px;
                margin: 5px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }

            .code-example {
                background: #f5f5f5;
                padding: 15px;
                border-radius: 5px;
                margin: 20px 0;
                font-family: "Courier New", monospace;
                white-space: pre-wrap;
            }

            .status {
                padding: 10px;
                margin: 10px 0;
                border-radius: 4px;
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Clippy.js - Modern Promise-based API</h1>

            <div id="status" class="status" style="display: none"></div>

            <div class="controls">
                <h2>Load Agent</h2>
                <select id="agentSelect">
                    <option value="Clippy">Clippy</option>
                    <option value="Bonzi">Bonzi</option>
                    <option value="F1">F1</option>
                    <option value="Genie">Genie</option>
                    <option value="Genius">Genius</option>
                    <option value="Links">Links</option>
                    <option value="Merlin">Merlin</option>
                    <option value="Peedy">Peedy</option>
                    <option value="Rocky">Rocky</option>
                    <option value="Rover">Rover</option>
                </select>
                <button id="loadBtn">Load Agent</button>
            </div>

            <div class="controls" id="agentControls" style="display: none">
                <h2>Agent Controls</h2>

                <div>
                    <input
                        type="text"
                        id="speakInput"
                        placeholder="Enter message..."
                        style="width: 300px"
                    />
                    <button id="speakBtn">Speak</button>
                </div>

                <div>
                    <button id="showBtn">Show</button>
                    <button id="hideBtn">Hide</button>
                    <button id="animateBtn">Random Animation</button>
                    <button id="gestureBtn">Gesture</button>
                    <button id="stopBtn">Stop</button>
                </div>

                <div>
                    <h3>Animations</h3>
                    <select id="animationSelect" style="width: 200px">
                        <option value="">Select animation...</option>
                    </select>
                    <button id="playAnimationBtn">Play Animation</button>
                </div>
            </div>

            <div class="code-example">
                <h3>Example Code (Promise-based API):</h3>
                // Load an agent const agent = await clippy.load('Clippy'); //
                Show the agent await agent.show(); // Make them speak await
                agent.speak('Hello! I am using Promises now!'); // Play an
                animation await agent.play('Searching'); // Move to a position
                await agent.moveTo(400, 300); // Chain multiple actions await
                agent.speak('Watch this!'); await agent.play('GetAttention');
                await agent.speak('Pretty cool, right?');
            </div>
        </div>

        <!-- Load Clippy.js -->
        <script type="module">
            // Import the modern clippy library
            import clippy from "../dist/index.esm.js";

            let currentAgent = null;
            const statusEl = document.getElementById("status");
            const agentControls = document.getElementById("agentControls");

            function showStatus(message, isError = false) {
                statusEl.textContent = message;
                statusEl.className = isError ? "status error" : "status";
                statusEl.style.display = "block";

                if (!isError) {
                    setTimeout(() => {
                        statusEl.style.display = "none";
                    }, 3000);
                }
            }

            // Load agent button
            document
                .getElementById("loadBtn")
                .addEventListener("click", async () => {
                    const agentName =
                        document.getElementById("agentSelect").value;

                    try {
                        showStatus(`Loading ${agentName}...`);

                        // If there's a current agent, destroy it first
                        if (currentAgent) {
                            currentAgent.destroy();
                        }

                        // Load the new agent using Promise-based API
                        currentAgent = await clippy.load(agentName);

                        // Show the agent
                        await currentAgent.show();

                        // Initial greeting
                        await currentAgent.speak(
                            `Hi! I'm ${agentName}. Thanks for using the new Promise-based API!`,
                        );

                        // Update animations list
                        const animations = currentAgent.getAnimations();
                        const animationSelect =
                            document.getElementById("animationSelect");
                        animationSelect.innerHTML =
                            '<option value="">Select animation...</option>';
                        animations.forEach((anim) => {
                            const option = document.createElement("option");
                            option.value = anim;
                            option.textContent = anim;
                            animationSelect.appendChild(option);
                        });

                        agentControls.style.display = "block";
                        showStatus(`${agentName} loaded successfully!`);
                    } catch (error) {
                        showStatus(
                            `Error loading agent: ${error.message}`,
                            true,
                        );
                        console.error(error);
                    }
                });

            // Speak button
            document
                .getElementById("speakBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;

                    const message = document.getElementById("speakInput").value;
                    if (message) {
                        try {
                            await currentAgent.speak(message);
                            document.getElementById("speakInput").value = "";
                        } catch (error) {
                            showStatus(`Error: ${error.message}`, true);
                        }
                    }
                });

            // Show button
            document
                .getElementById("showBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;
                    try {
                        await currentAgent.show();
                        showStatus("Agent shown");
                    } catch (error) {
                        showStatus(`Error: ${error.message}`, true);
                    }
                });

            // Hide button
            document
                .getElementById("hideBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;
                    try {
                        await currentAgent.hide();
                        showStatus("Agent hidden");
                    } catch (error) {
                        showStatus(`Error: ${error.message}`, true);
                    }
                });

            // Animate button
            document
                .getElementById("animateBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;
                    try {
                        await currentAgent.animate();
                        showStatus("Playing random animation");
                    } catch (error) {
                        showStatus(`Error: ${error.message}`, true);
                    }
                });

            // Gesture button
            document
                .getElementById("gestureBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;
                    try {
                        // Gesture at mouse position
                        const x = Math.random() * window.innerWidth;
                        const y = Math.random() * window.innerHeight;
                        await currentAgent.gestureAt(x, y);
                        showStatus("Gesturing");
                    } catch (error) {
                        showStatus(`Error: ${error.message}`, true);
                    }
                });

            // Stop button
            document.getElementById("stopBtn").addEventListener("click", () => {
                if (!currentAgent) return;
                currentAgent.stop();
                showStatus("Stopped all animations");
            });

            // Play animation button
            document
                .getElementById("playAnimationBtn")
                .addEventListener("click", async () => {
                    if (!currentAgent) return;

                    const animation =
                        document.getElementById("animationSelect").value;
                    if (animation) {
                        try {
                            await currentAgent.play(animation);
                            showStatus(`Playing ${animation}`);
                        } catch (error) {
                            showStatus(`Error: ${error.message}`, true);
                        }
                    }
                });

            // Enter key for speak input
            document
                .getElementById("speakInput")
                .addEventListener("keypress", (e) => {
                    if (e.key === "Enter") {
                        document.getElementById("speakBtn").click();
                    }
                });

            // Demonstrate chaining promises
            window.demoChain = async () => {
                if (!currentAgent) {
                    showStatus("Please load an agent first", true);
                    return;
                }

                try {
                    showStatus("Starting demo chain...");

                    await currentAgent.speak(
                        "Let me show you Promise chaining!",
                    );
                    await currentAgent.play("Searching");
                    await currentAgent.speak(
                        "I can do multiple things in sequence",
                    );
                    await currentAgent.play("GetAttention");
                    await currentAgent.speak(
                        "All with clean async/await syntax!",
                    );
                    await currentAgent.animate();

                    showStatus("Demo chain complete!");
                } catch (error) {
                    showStatus(`Error in chain: ${error.message}`, true);
                }
            };

            // Make it available globally for console testing
            window.clippy = clippy;
            window.agent = () => currentAgent;
        </script>
    </body>
</html>
