!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).clippy={},e.React)}(this,function(e,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=i(t);class s{constructor(e){this.queue=[],this.active=!1,this.onEmptyCallback=e}enqueue(e){this.queue.push(e),1!==this.queue.length||this.active||this.progressQueue()}clear(){this.queue=[],this.active=!1}next(){this.active=!1,this.progressQueue()}size(){return this.queue.length}isActive(){return this.active}progressQueue(){if(!this.queue.length)return void(this.onEmptyCallback&&this.onEmptyCallback());const e=this.queue.shift();if(!e)return;this.active=!0;e(()=>this.next())}}class o{constructor(e,t,i,n){this.sounds={},this.overlays=[],this.currentFrameIndex=0,this.exiting=!1,this.started=!1,this.paused=!1,this.element=e,this.data=i,this.path=t,this.preloadSounds(n),this.setupElements()}setupElements(){this.overlays=[this.element];let e=this.element;this.setupElementStyle(this.element);for(let t=1;t<this.data.overlayCount;t++){const t=document.createElement("div");this.setupElementStyle(t),e.appendChild(t),this.overlays.push(t),e=t}}setupElementStyle(e){const[t,i]=this.data.framesize;e.style.display="none",e.style.width=`${t}px`,e.style.height=`${i}px`,e.style.background=`url('${this.path}/map.png') no-repeat`}preloadSounds(e){for(const t of this.data.sounds){const i=e[t];i&&(this.sounds[t]=new Audio(i))}}getAnimations(){return Object.keys(this.data.animations)}hasAnimation(e){return!!this.data.animations[e]}showAnimation(e,t){return this.exiting=!1,!!this.hasAnimation(e)&&(this.currentAnimation=this.data.animations[e],this.currentAnimationName=e,this.started||(this.step(),this.started=!0),this.currentFrameIndex=0,this.currentFrame=void 0,this.endCallback=t,!0)}exitAnimation(){this.exiting=!0}pause(){this.paused=!0,this.loop&&(window.clearTimeout(this.loop),this.loop=void 0)}resume(){this.paused=!1,this.currentAnimation&&this.step()}step(){if(!this.currentAnimation||this.paused)return;const e=Math.min(this.getNextAnimationFrame(),this.currentAnimation.frames.length-1),t=!this.currentFrame||this.currentFrameIndex!==e;this.currentFrameIndex=e,this.atLastFrame()&&this.currentAnimation.useExitBranching||(this.currentFrame=this.currentAnimation.frames[this.currentFrameIndex]),this.draw(),this.playSound(),this.currentFrame&&(this.loop=window.setTimeout(()=>this.step(),this.currentFrame.duration)),this.endCallback&&t&&this.atLastFrame()&&(this.currentAnimation.useExitBranching&&!this.exiting?this.endCallback(this.currentAnimationName,o.States.WAITING):this.endCallback(this.currentAnimationName,o.States.EXITED))}getNextAnimationFrame(){if(!this.currentAnimation)return 0;if(!this.currentFrame)return 0;const e=this.currentFrame,t=e.branching;if(this.exiting&&void 0!==e.exitBranch)return e.exitBranch;if(t){let e=100*Math.random();for(const i of t.branches){if(e<=i.weight)return i.frameIndex;e-=i.weight}}return this.currentFrameIndex+1}draw(){const e=this.currentFrame?.images||[];for(let t=0;t<this.overlays.length;t++)if(t<e.length){const[i,n]=e[t],s=`-${i}px -${n}px`;this.overlays[t].style.backgroundPosition=s,this.overlays[t].style.display="block"}else this.overlays[t].style.display="none"}playSound(){if(!this.currentFrame?.sound)return;const e=this.currentFrame.sound;if("string"==typeof e){const t=this.sounds[e];t&&t.play().catch(()=>{})}}atLastFrame(){return!!this.currentAnimation&&this.currentFrameIndex>=this.currentAnimation.frames.length-1}destroy(){this.pause(),this.overlays=[],this.sounds={}}}o.States={WAITING:"WAITING",EXITED:"EXITED",PLAYING:"PLAYING"};class r{constructor(e){this.hidden=!0,this.active=!1,this.hold=!1,this.WORD_SPEAK_TIME=200,this.CLOSE_BALLOON_DELAY=2e3,this.BALLOON_MARGIN=15,this.targetEl=e,this.balloonEl=this.createBalloonElement(),this.contentEl=this.balloonEl.querySelector(".clippy-content"),this.tipEl=this.balloonEl.querySelector(".clippy-tip"),document.body.appendChild(this.balloonEl)}createBalloonElement(){const e=document.createElement("div");e.className="clippy-balloon",e.style.display="none";const t=document.createElement("div");t.className="clippy-tip";const i=document.createElement("div");return i.className="clippy-content",e.appendChild(t),e.appendChild(i),e}speak(e,t=!1){return new Promise(i=>{this.hidden=!1,this.show(),this.contentEl.style.height="auto",this.contentEl.style.width="auto",this.contentEl.textContent=e;const n=this.contentEl.offsetHeight,s=this.contentEl.offsetWidth;this.contentEl.style.height=`${n}px`,this.contentEl.style.width=`${s}px`,this.contentEl.textContent="",this.reposition(),this.completeCallback=i,this.sayWords(e,t)})}show(){this.hidden||(this.balloonEl.style.display="block")}hide(e=!1){if(e)return this.balloonEl.style.display="none",void(this.hidden=!0);this.hidingTimeout=window.setTimeout(()=>{this.finishHideBalloon()},this.CLOSE_BALLOON_DELAY)}close(){this.active?this.hold=!1:this.hold&&this.completeCallback&&this.completeCallback()}pause(){this.wordTimeout&&window.clearTimeout(this.wordTimeout),this.hidingTimeout&&(window.clearTimeout(this.hidingTimeout),this.hidingTimeout=void 0)}resume(){this.active?this.addWord&&this.addWord():this.hold||this.hidden||(this.hidingTimeout=window.setTimeout(()=>{this.finishHideBalloon()},this.CLOSE_BALLOON_DELAY))}reposition(){const e=["top-left","top-right","bottom-left","bottom-right"];for(const t of e)if(this.position(t),!this.isOutOfBounds())break}position(e){const t=this.targetEl.getBoundingClientRect(),i=this.balloonEl.offsetHeight,n=this.balloonEl.offsetWidth;this.balloonEl.classList.remove("clippy-top-left","clippy-top-right","clippy-bottom-left","clippy-bottom-right");let s=0,o=0;switch(e){case"top-left":s=t.left+t.width-n,o=t.top-i-this.BALLOON_MARGIN;break;case"top-right":s=t.left,o=t.top-i-this.BALLOON_MARGIN;break;case"bottom-right":s=t.left,o=t.top+t.height+this.BALLOON_MARGIN;break;case"bottom-left":s=t.left+t.width-n,o=t.top+t.height+this.BALLOON_MARGIN}this.balloonEl.style.top=`${o}px`,this.balloonEl.style.left=`${s}px`,this.balloonEl.classList.add(`clippy-${e}`)}isOutOfBounds(){const e=this.balloonEl.getBoundingClientRect();return e.top-5<0||e.left-5<0||(e.bottom+5>window.innerHeight||e.right+5>window.innerWidth)}sayWords(e,t){this.active=!0,this.hold=t;const i=e.split(/\s+/);let n=0;const s=()=>{this.active&&(n>=i.length?(this.active=!1,this.hold||(this.completeCallback&&this.completeCallback(),this.hide())):(this.contentEl.textContent=i.slice(0,n+1).join(" "),n++,this.wordTimeout=window.setTimeout(s,this.WORD_SPEAK_TIME)))};this.addWord=s,s()}finishHideBalloon(){this.active||(this.balloonEl.style.display="none",this.hidden=!0,this.hidingTimeout=void 0)}destroy(){this.hidingTimeout&&window.clearTimeout(this.hidingTimeout),this.wordTimeout&&window.clearTimeout(this.wordTimeout),this.balloonEl.remove()}}class a{constructor(e,t,i,n){this.hidden=!1,this.handleResize=()=>{this.reposition()},this.path=e,this.element=document.createElement("div"),this.element.className="clippy",this.element.style.display="none",this.element.style.position="fixed",this.element.style.zIndex="9999",document.body.appendChild(this.element),this.queue=new s(()=>this.onQueueEmpty()),this.animator=new o(this.element,e,t,i),this.balloon=new r(this.element),this.setupEvents(n)}async show(e=!1){if(this.hidden=!1,e)return this.element.style.display="block",this.resume(),this.onQueueEmpty(),Promise.resolve();if("auto"===this.element.style.top||"auto"===this.element.style.left){const e=.8*window.innerWidth,t=.8*(window.innerHeight+window.scrollY);this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}return this.element.style.display="block",this.resume(),this.play("Show")}async hide(e=!1){return this.hidden=!0,this.stop(),e?(this.element.style.display="none",this.pause(),Promise.resolve()):new Promise(e=>{this.playInternal("Hide",(t,i)=>{i===o.States.EXITED&&(this.element.style.display="none",this.pause(),e())})})}play(e,t=5e3){return this.hasAnimation(e)?new Promise(i=>{this.queue.enqueue(n=>{let s=!1;t&&window.setTimeout(()=>{s||this.animator.exitAnimation()},t),this.playInternal(e,(e,t)=>{t===o.States.EXITED&&(s=!0,i(),n())})})}):Promise.reject(new Error(`Animation "${e}" not found`))}speak(e,t=!1){return new Promise(i=>{this.queue.enqueue(async n=>{await this.balloon.speak(e,t),n(),i()})})}closeBalloon(){this.balloon.hide()}moveTo(e,t,i=1e3){const n=`Move${this.getDirection(e,t)}`;return new Promise(s=>{this.queue.enqueue(r=>{if(0===i)return this.element.style.left=`${e}px`,this.element.style.top=`${t}px`,this.reposition(),r(),void s();if(!this.hasAnimation(n))return void this.animatePosition(e,t,i,()=>{r(),s()});this.playInternal(n,(n,a)=>{a===o.States.EXITED?(r(),s()):a===o.States.WAITING&&this.animatePosition(e,t,i,()=>{this.animator.exitAnimation()})})})})}async gestureAt(e,t){const i=this.getDirection(e,t),n=`Gesture${i}`,s=`Look${i}`,o=this.hasAnimation(n)?n:s;return this.play(o)}async animate(){const e=this.getAnimations().filter(e=>!e.startsWith("Idle"));if(0===e.length)return Promise.resolve();const t=e[Math.floor(Math.random()*e.length)];return this.play(t)}delay(e=250){return new Promise(t=>{this.queue.enqueue(i=>{this.onQueueEmpty(),window.setTimeout(()=>{i(),t()},e)})})}stop(){this.queue.clear(),this.animator.exitAnimation(),this.balloon.hide()}stopCurrent(){this.animator.exitAnimation(),this.balloon.close()}pause(){this.animator.pause(),this.balloon.pause()}resume(){this.animator.resume(),this.balloon.resume()}hasAnimation(e){return this.animator.hasAnimation(e)}getAnimations(){return this.animator.getAnimations()}reposition(){if(!this.isVisible())return;const e=this.element.getBoundingClientRect();let{top:t,left:i}=e;t-5<0?t=5:t+e.height+5>window.innerHeight&&(t=window.innerHeight-e.height-5),i-5<0?i=5:i+e.width+5>window.innerWidth&&(i=window.innerWidth-e.width-5),this.element.style.left=`${i}px`,this.element.style.top=`${t}px`,this.balloon.reposition()}destroy(){this.stop(),window.removeEventListener("resize",this.handleResize),this.element.remove(),this.animator.destroy(),this.balloon.destroy()}setupEvents(e){this.handleResize=this.handleResize.bind(this),window.addEventListener("resize",this.handleResize),this.element.addEventListener("mousedown",e=>this.onMouseDown(e)),this.element.addEventListener("dblclick",()=>this.onDoubleClick(e))}onMouseDown(e){e.preventDefault(),this.startDrag(e)}onDoubleClick(e){e?.onDoubleClick?e.onDoubleClick():this.play("ClickedOn")||this.animate()}startDrag(e){this.pause(),this.balloon.hide(!0);const t=this.element.getBoundingClientRect();this.dragOffset={top:e.clientY-t.top,left:e.clientX-t.left},this.moveHandler=e=>this.dragMove(e),this.upHandler=()=>this.finishDrag(),window.addEventListener("mousemove",this.moveHandler),window.addEventListener("mouseup",this.upHandler),this.updateDragPosition()}dragMove(e){e.preventDefault(),this.dragOffset&&(this.targetX=e.clientX-this.dragOffset.left,this.targetY=e.clientY-this.dragOffset.top)}updateDragPosition(){void 0!==this.targetX&&void 0!==this.targetY&&(this.element.style.left=`${this.targetX}px`,this.element.style.top=`${this.targetY}px`),this.dragUpdateLoop=window.setTimeout(()=>this.updateDragPosition(),10)}finishDrag(){this.dragUpdateLoop&&window.clearTimeout(this.dragUpdateLoop),this.moveHandler&&this.upHandler&&(window.removeEventListener("mousemove",this.moveHandler),window.removeEventListener("mouseup",this.upHandler)),this.balloon.show(),this.reposition(),this.resume()}playInternal(e,t){this.isIdleAnimation()&&this.idleDeferred?this.idleDeferred.then(()=>{this.playInternal(e,t)}):this.animator.showAnimation(e,t)}onQueueEmpty(){if(this.hidden||this.isIdleAnimation())return;const e=this.getIdleAnimation();this.idleDeferred=new Promise(e=>{this.idleResolve=e}),this.animator.showAnimation(e,(e,t)=>{t===o.States.EXITED&&this.idleResolve&&(this.idleResolve(),this.idleDeferred=void 0,this.idleResolve=void 0)})}isIdleAnimation(){const e=this.animator.currentAnimationName;return!!e&&e.startsWith("Idle")}getIdleAnimation(){const e=this.getAnimations(),t=e.filter(e=>e.startsWith("Idle"));return 0===t.length?e[0]||"Idle1":t[Math.floor(Math.random()*t.length)]}getDirection(e,t){const i=this.element.getBoundingClientRect(),n=i.left+i.width/2,s=i.top+i.height/2-t,o=n-e,r=Math.round(180*Math.atan2(s,o)/Math.PI);return-45<=r&&r<45?"Right":45<=r&&r<135?"Up":135<=r&&r<=180||-180<=r&&r<-135?"Left":-135<=r&&r<-45?"Down":"Up"}animatePosition(e,t,i,n){const s=parseInt(this.element.style.left)||0,o=parseInt(this.element.style.top)||0,r=Date.now(),a=()=>{const l=Date.now()-r,h=Math.min(l/i,1),u=s+(e-s)*h,c=o+(t-o)*h;this.element.style.left=`${u}px`,this.element.style.top=`${c}px`,h<1?requestAnimationFrame(a):n()};a()}isVisible(){return"none"!==this.element.style.display}}const l=new Map,h=new Map,u=new Map,c=new Map,d=new Map;async function p(e,t){const i=`${t?.basePath||window.CLIPPY_CDN||"https://gitcdn.xyz/repo/pi0/clippyjs/master/assets/agents/"}${e}`,[,n,s]=await Promise.all([m(i),f(e,i),y(e,i)]);return new a(i,n,s)}async function m(e){const t=l.get(e);if(t)return t;const i=new Promise((t,i)=>{const n=new Image;n.onload=()=>t(),n.onerror=()=>i(new Error(`Failed to load map: ${e}/map.png`)),n.src=`${e}/map.png`});return l.set(e,i),i}async function f(e,t){const i=u.get(e);if(i)return i;const n=new Promise((i,n)=>{c.set(e,i);const s=document.createElement("script");s.src=`${t}/agent.js`,s.async=!0,s.onerror=()=>{c.delete(e),n(new Error(`Failed to load agent data: ${t}/agent.js`))},document.head.appendChild(s)});return u.set(e,n),n}async function y(e,t){const i=h.get(e);if(i)return i;const n=new Promise((i,n)=>{const s=document.createElement("audio"),o=!!s.canPlayType&&""!==s.canPlayType("audio/mpeg"),r=!!s.canPlayType&&""!==s.canPlayType('audio/ogg; codecs="vorbis"');if(!o&&!r)return void i({});d.set(e,i);const a=o?"sounds-mp3.js":"sounds-ogg.js",l=document.createElement("script");l.src=`${t}/${a}`,l.async=!0,l.onerror=()=>{d.delete(e),i({})},document.head.appendChild(l)});return h.set(e,n),n}function g(e,t){const i=c.get(e);i&&(i(t),c.delete(e))}function w(e,t){const i=d.get(e);i&&(i(t),d.delete(e))}"undefined"!=typeof window&&(window.clippy={...window.clippy||{},ready:g,soundsReady:w});var b,v={exports:{}},E={};var A,k,x={};
/**
     * @license React
     * react-jsx-runtime.development.js
     *
     * Copyright (c) Meta Platforms, Inc. and affiliates.
     *
     * This source code is licensed under the MIT license found in the
     * LICENSE file in the root directory of this source tree.
     */function S(){return A||(A=1,"production"!==process.env.NODE_ENV&&function(){function e(t){if(null==t)return null;if("function"==typeof t)return t.$$typeof===S?null:t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case p:return"Fragment";case f:return"Profiler";case m:return"StrictMode";case b:return"Suspense";case v:return"SuspenseList";case k:return"Activity"}if("object"==typeof t)switch("number"==typeof t.tag&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),t.$$typeof){case d:return"Portal";case g:return(t.displayName||"Context")+".Provider";case y:return(t._context.displayName||"Context")+".Consumer";case w:var i=t.render;return(t=t.displayName)||(t=""!==(t=i.displayName||i.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case E:return null!==(i=t.displayName||null)?i:e(t.type)||"Memo";case A:i=t._payload,t=t._init;try{return e(t(i))}catch(e){}}return null}function t(e){return""+e}function i(e){try{t(e);var i=!1}catch(e){i=!0}if(i){var n=(i=console).error,s="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return n.call(i,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",s),t(e)}}function s(t){if(t===p)return"<>";if("object"==typeof t&&null!==t&&t.$$typeof===A)return"<...>";try{var i=e(t);return i?"<"+i+">":"<...>"}catch(e){return"<...>"}}function o(){return Error("react-stack-top-frame")}function r(){var t=e(this.type);return C[t]||(C[t]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),void 0!==(t=this.props.ref)?t:null}function a(t,n,s,o,a,u,d,p){var m,f=n.children;if(void 0!==f)if(o)if(I(f)){for(o=0;o<f.length;o++)l(f[o]);Object.freeze&&Object.freeze(f)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else l(f);if(O.call(n,"key")){f=e(t);var y=Object.keys(n).filter(function(e){return"key"!==e});o=0<y.length?"{key: someKey, "+y.join(": ..., ")+": ...}":"{key: someKey}",L[f+o]||(y=0<y.length?"{"+y.join(": ..., ")+": ...}":"{}",console.error('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',o,f,y,f),L[f+o]=!0)}if(f=null,void 0!==s&&(i(s),f=""+s),function(e){if(O.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(n)&&(i(n.key),f=""+n.key),"key"in n)for(var g in s={},n)"key"!==g&&(s[g]=n[g]);else s=n;return f&&function(e,t){function i(){h||(h=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",t))}i.isReactWarning=!0,Object.defineProperty(e,"key",{get:i,configurable:!0})}(s,"function"==typeof t?t.displayName||t.name||"Unknown":t),function(e,t,i,n,s,o,a,l){return i=o.ref,e={$$typeof:c,type:e,key:t,props:o,_owner:s},null!==(void 0!==i?i:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:r}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:a}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:l}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(t,f,u,0,null===(m=T.A)?null:m.getOwner(),s,d,p)}function l(e){"object"==typeof e&&null!==e&&e.$$typeof===c&&e._store&&(e._store.validated=1)}var h,u=n.default,c=Symbol.for("react.transitional.element"),d=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),g=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),S=Symbol.for("react.client.reference"),T=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O=Object.prototype.hasOwnProperty,I=Array.isArray,P=console.createTask?console.createTask:function(){return null},C={},_=(u={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(u,o)(),N=P(s(o)),L={};x.Fragment=p,x.jsx=function(e,t,i,n,o){var r=1e4>T.recentlyCreatedOwnerStacks++;return a(e,t,i,!1,0,o,r?Error("react-stack-top-frame"):_,r?P(s(e)):N)},x.jsxs=function(e,t,i,n,o){var r=1e4>T.recentlyCreatedOwnerStacks++;return a(e,t,i,!0,0,o,r?Error("react-stack-top-frame"):_,r?P(s(e)):N)}}()),x}var T=(k||(k=1,"production"===process.env.NODE_ENV?v.exports=function(){if(b)return E;b=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(t,i,n){var s=null;if(void 0!==n&&(s=""+n),void 0!==i.key&&(s=""+i.key),"key"in i)for(var o in n={},i)"key"!==o&&(n[o]=i[o]);else n=i;return i=n.ref,{$$typeof:e,type:t,key:s,ref:void 0!==i?i:null,props:n}}return E.Fragment=t,E.jsx=i,E.jsxs=i,E}():v.exports=S()),v.exports);const O=t.createContext(void 0),I=()=>{const e=t.useContext(O);if(!e)throw new Error("useClippy must be used within a ClippyProvider");return e},P={load:p,ready:g,soundsReady:w,Agent:a,Animator:o,Balloon:r,Queue:s};"undefined"!=typeof window&&(window.clippy=P),e.Agent=a,e.Animator=o,e.Balloon=r,e.Clippy=({name:e,basePath:i,showOnLoad:n=!0,onLoad:s,onError:o,position:r,speak:a,holdSpeech:l=!1})=>{const{loadAgent:h,getAgent:u,unloadAgent:c}=I(),[d,p]=t.useState(),[m,f]=t.useState(!0),[y,g]=t.useState(null),w=t.useRef(!0);return t.useEffect(()=>{let t;w.current=!0;return(async()=>{try{if(f(!0),g(null),t=u(e),t?n&&await t.show():t=await h(e,{basePath:i,show:n}),!w.current)return;p(t),r&&t&&await t.moveTo(r.x,r.y,0),a&&t&&await t.speak(a,l),s&&t&&s(t)}catch(e){if(!w.current)return;const t=e;g(t),o&&o(t)}finally{w.current&&f(!1)}})(),()=>{w.current=!1}},[e,i,n]),t.useEffect(()=>{d&&a&&d.speak(a,l)},[a,l]),null},e.ClippyProvider=({children:e,defaultBasePath:i})=>{const[n,s]=t.useState(new Map);t.useEffect(()=>()=>{n.forEach(e=>e.destroy())},[]);const o={agents:n,loadAgent:async(e,t)=>{const o=n.get(e);if(o)return o;try{const n=await p(e,{basePath:t?.basePath||i});return s(t=>new Map(t).set(e,n)),!1!==t?.show&&await n.show(),n}catch(t){throw console.error(`Failed to load agent ${e}:`,t),t}},unloadAgent:e=>{const t=n.get(e);t&&(t.destroy(),s(t=>{const i=new Map(t);return i.delete(e),i}))},getAgent:e=>n.get(e)};return T.jsx(O.Provider,{value:o,children:e})},e.Queue=s,e.default=P,e.load=p,e.ready=g,e.soundsReady=w,e.useAgent=e=>{const{loadAgent:i,getAgent:n,unloadAgent:s}=I(),[o,r]=t.useState(()=>n(e)),[a,l]=t.useState(!1),[h,u]=t.useState(null);return t.useEffect(()=>{const t=n(e);t!==o&&r(t)},[e]),{agent:o,loading:a,error:h,load:async()=>{try{l(!0),u(null);const t=await i(e);r(t)}catch(e){u(e)}finally{l(!1)}},unload:()=>{s(e),r(void 0)}}},e.useClippy=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=clippy.min.js.map
